// Generated by CoffeeScript 1.6.2
(function() {
  $(document).ready(function() {
    var changeTimeRange, doMetric, loadKpiBoard, loadSideBar, redrawWithOptions;

    loadKpiBoard = function() {
      $('#kpi-board-content').html('<img src="/static/loading.gif" />');
      return $('#kpi-board-content').load('/websites/kpi');
    };
    loadKpiBoard();
    redrawWithOptions = function() {
      return $.post("/websites/set_bar_options", $('#bar-chart-options').serialize()).done(function(data) {
        return drawBarNew();
      });
    };
    doMetric = function(e) {
      return $.post("/websites/set_metric", $(this).serialize()).done(function(data) {
        drawBarNew();
        return drawBubbleChart();
      });
    };
    $("#omni-metric-left").change(doMetric);
    $("#omni-metric-right").change(doMetric);
    $("#bubble-metric-left").change(doMetric);
    $("#bubble-metric-right").change(doMetric);
    $("#bubble-metric-size").change(doMetric);
    $('input[name="omni-seperation"]').change(function(e) {
      return $.post("/websites/set_seperation", $(this).serialize()).done(function(data) {
        return drawBarNew();
      });
    });
    $('input[name="kpi-seperation"]').change(function(e) {
      return $.post("/websites/set_seperation", $(this).serialize()).done(function(data) {
        return loadKpiBoard();
      });
    });
    $('input[name="bubble-seperation"]').change(function(e) {
      return $.post("/websites/set_seperation", $(this).serialize()).done(function(data) {
        return drawBubbleChart();
      });
    });
    $('input[name="omni-days"]').change(function(e) {
      return $.post("/websites/set_days", $(this).serialize()).done(function(data) {
        return drawBarNew();
      });
    });
    $('input[name="kpi-days"]').change(function(e) {
      return $.post("/websites/set_days", $(this).serialize()).done(function(data) {
        return loadKpiBoard();
      });
    });
    $('input[name="bubble-days"]').change(function(e) {
      return $.post("/websites/set_days", $(this).serialize()).done(function(data) {
        return drawBubbleChart();
      });
    });
    $("#timerange-value").hide();
    changeTimeRange = function(e) {
      var el, val;

      el = this;
      val = $(el).val();
      if (val === 'today') {
        $("#timerange-value").hide();
      } else {
        $("#timerange-value").show();
        $("#timerange-value").focus();
      }
      return redrawWithOptions();
    };
    $('#timerange-unit').change(changeTimeRange);
    $('#timerange-value').blur(redrawWithOptions);
    $('#charts-tabs a').click(function(e) {
      $(this).tab('show');
      window.location.hash = '#!' + this.hash;
      if ($(this).attr('data-chart') === 'bar') {
        drawBarNew();
      }
      if ($(this).attr('data-chart') === 'bubble') {
        return drawBubbleChart();
      }
    });
    loadSideBar = function() {
      return $('#sidebar').load('/websites/sidebar', function() {
        drawCalendar();
        $('.chzn-select').chosen();
        return $('#btn-filter').click(function(e) {
          e.preventDefault();
          return $.post("/websites/filter", $("#filter-form").serialize()).done(function(data) {
            loadKpiBoard();
            return drawBarNew();
          });
        });
      });
    };
    $('.chzn-select').chosen();
    return loadSideBar();
  });

}).call(this);
