{% extends "layouts/base.html" %}
{%load static %}
{%block title%}Website Dashboard{%endblock%}

{%block content %}


<ul class="nav nav-tabs" id="charts-tabs">
  <li class="active"><a href="#line-chart" data-toggle="tab">Line Chart</a></li>
  <li><a data-chart="bubble" href="#bubble-chart" data-toggle="tab">Bubble Chart</a></li>
  <li><a data-chart="bar" href="#bar-chart" data-toggle="tab">Bar Chart</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="line-chart">
      <div class="well well-small">
          How much days did it take <i>in average</i> for customers to reach <strong>100%</strong> Return on Investment?
          <br /><small>(Only for customers who joined with the channels and campaigns specified in the filter)</small>
      </div>
      <svg style="height:600px;width:800px"></svg>
  </div>
  <div class="tab-pane" id="bubble-chart">
      <svg style="height:600px;width:800px"></svg>
  </div>
  <div class="tab-pane" id="bar-chart">
      <svg style="height:400px;width:800px"></svg>
  </div>
</div>

<script>

var jsonBubble = {{bubble_json|safe}};
function drawBubbleChart() { 
    nv.addGraph(function() {
        var chart = nv.models.scatterChart()
                      .showDistX(true)
                      .showDistY(true)
                      .showControls(false)
                      .color(d3.scale.category20().range());
        
        chart.xAxis.tickFormat(d3.format('.02f'))
        chart.yAxis.tickFormat(d3.format('.02f'))
        
        d3.select('#bubble-chart svg')
            .datum(jsonBubble)
          .transition().duration(500)
            .call(chart);
        
        nv.utils.windowResize(chart.update);
        return chart;
    });
}

var jsonLine = {{line_json|safe}};
function drawLineChart() {
    nv.addGraph(function() {
        var chart = nv.models.lineWithFocusChart();
        chart.xAxis
           .tickFormat(function(d) { return d3.time.format('%b %d')(new Date(d)); });
           
        chart.x2Axis
             .tickFormat(function(d) { return d3.time.format('%b %d')(new Date(d)); });
        chart.yAxis
             .tickFormat(d3.format('.f'));
        
        chart.y2Axis
             .tickFormat(d3.format('.f'));
    
      d3.select('#line-chart svg')
          .datum(jsonLine)
        .transition().duration(500)
          .call(chart);
    
      nv.utils.windowResize(chart.update);
    
      return chart;
    });
}


var jsonBar = {{bar_json|safe}};
function drawBarChart() {
    nv.addGraph(function() {
        console.log(jsonBar);
        var chart = nv.models.multiBarChart()
                    .stacked(true)
                    .color(d3.scale.category20().range())
                    .showControls(false);
    
        chart.xAxis
            .tickFormat(function(d) { return d3.time.format('%b %d')(new Date(d)); });
    
        chart.yAxis
            .tickFormat(d3.format(',.2f'));
    
        d3.select('#bar-chart svg')
            .datum(jsonBar)
          .transition().duration(500).call(chart);
    
        nv.utils.windowResize(chart.update);
    
        return chart;
    });
}

</script>
{%endblock%}


{%block sidebar%}
<form id="filter-form" action="/websites/filter" method="post">
  <fieldset>
    <legend>Filter</legend>
<label for="filter-channel">Channel</label>
<select name="filter-channel" data-placeholder="select one or more channels" multiple="multiple" class="chzn-select">
<!--<option selected="selected" value="_all">all</option>-->
{% for channel in channels %}
<option {% if channel.id in filter.channel %}selected="selected"{% endif %} value="{{channel.id}}">{{channel.name}}</option>
{% endfor %}
</select>


<label for="filter_campaign">Campaigns</label>
<select name="filter_campaign" data-placeholder="select one or more campaigns" multiple="multiple" class="chzn-select">
<!--<option selected="selected" value="_all">all</option>-->
{% for campaign in campaigns %}
<option value="{{campaign.id}}">{{campaign.name}}</option>
{% endfor %}
</select>

<!--
<label for="filter-partner">Partner</label>
<select name="filter-partner" data-placeholder="select one or more partner" multiple="multiple" class="chzn-select">
<!--<option selected="selected" value="_all">all</option>-- >
{% for partner in partners %}
<option value="{{partner.id}}">{{partner.name}}</option>
{% endfor %}
</select>
-->
 <button type="submit" class="btn" id="btn-filter">Save</button>
 </fieldset>
</form>

{%endblock%}


{%block head_extra %}
<link href="/static/js/nv/src/nv.d3.css" rel="stylesheet">
<link href="/static/chosen/chosen.css" rel="stylesheet">
<link href="/static/styles/charts.css" rel="stylesheet">
<script src="/static/chosen/chosen.jquery.js"></script>
<!--<script src="/static/js/d3.v3.min.js"></script>-->
<script src="/static/js/nv/lib/d3.v2.js"></script>
<script src="/static/js/nv/nv.d3.js"></script>

<!--<script src="/static/js/app/src/charts.js"></script>-->
<script src="/static/js/app/src/main.js"></script>

{%endblock%}
